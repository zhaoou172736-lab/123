<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI çˆ†æ¬¾è§†é¢‘æ‹†è§£åŠ©æ‰‹ (Powered by Gemini)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #fff7ed; /* Orange-50 base */
            color: #44403c; /* Stone-700 */
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1c1917; 
        }
        ::-webkit-scrollbar-thumb {
            background: #44403c; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #57534e; 
        }
        
        .shimmer {
            background: linear-gradient(to right, #f97316 0%, #fb923c 50%, #f97316 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 100% 0; }
            100% { background-position: -100% 0; }
        }
        
        /* æŠ¥å‘Šå¡ç‰‡åŠ¨ç”» */
        .report-fade-in {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dropzone Styles */
        .drop-zone {
            transition: all 0.3s ease;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23d6d3d1' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }
        .drop-zone.dragover {
            background-color: #fff7ed;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23f97316' stroke-width='3' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            transform: scale(1.01);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col relative">

    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">ğŸ”¥</span>
                    <span class="text-xl font-bold text-stone-800">çˆ†æ¬¾æ‹†è§£åŠ©æ‰‹ <span class="text-xs text-white bg-gradient-to-r from-blue-500 to-purple-600 px-2 py-0.5 rounded-full ml-2 shadow-sm">AI Core</span></span>
                </div>
                <!-- Settings Button -->
                <div class="flex items-center">
                    <button onclick="toggleSettingsModal()" class="flex items-center text-stone-500 hover:text-stone-800 px-3 py-2 rounded-lg hover:bg-stone-100 transition duration-200" title="API è®¾ç½®">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span class="text-sm font-medium">API è®¾ç½®</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 sm:px-6 lg:px-8 max-w-7xl flex flex-col justify-center">
        
        <!-- Header Section -->
        <div class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-extrabold text-stone-900 mb-4">
                ä¸Šä¼ è§†é¢‘ï¼ŒAI <span class="text-orange-600">å…¨è‡ªåŠ¨æ‹†è§£</span> é€»è¾‘
            </h1>
            <!-- ç»™è¿™ä¸ª P æ ‡ç­¾åŠ äº† IDï¼Œç”¨äºåç»­åŠ¨æ€æ›¿æ¢å†…å®¹ -->
            <p id="header-intro" class="text-lg text-stone-600 max-w-2xl mx-auto transition-all duration-500 ease-in-out">
                ç›´æ¥ä¸Šä¼ çˆ†æ¬¾è§†é¢‘æ–‡ä»¶ï¼ŒAI å°†è‡ªåŠ¨åˆ†æå¹¶æ­ç§˜å…¶<span class="font-bold text-stone-700">â€œç”»é¢ã€è„šæœ¬ä¸æƒ…ç»ªâ€</span>èƒŒåçš„æµé‡å¯†ç ã€‚
            </p>
        </div>

        <!-- Tool Interface -->
        <!-- å¸ƒå±€ä¿®æ”¹ï¼šä» grid grid-cols-2 æ”¹ä¸º flex flex-colï¼Œå¹¶ç§»é™¤å›ºå®šé«˜åº¦ h-[650px] -->
        <div class="flex flex-col gap-8 w-full"> 
            
            <!-- Top Section: Input & Actions & META CARD -->
            <!-- å¸ƒå±€ä¿®æ”¹ï¼šæ”¹ä¸º w-full -->
            <div class="flex flex-col gap-6 w-full">
                
                <!-- Upload & Action Card -->
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-stone-200 flex flex-col flex-1 transform transition hover:scale-[1.002] duration-300 relative z-10">
                    <div class="mb-2 flex-grow flex flex-col">
                        <label class="block text-base font-bold text-stone-800 mb-4 flex items-center justify-between">
                            <span class="flex items-center">
                                <span class="bg-stone-800 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">1</span> 
                                ä¸Šä¼ çˆ†æ¬¾è§†é¢‘æ–‡ä»¶ (ä¸Šä¼ åè‡ªåŠ¨åˆ†æ)
                            </span>
                            <span class="text-xs font-normal text-stone-400 bg-stone-100 px-2 py-1 rounded">æ— é™åˆ¶ | è‡ªåŠ¨è¿è¡Œ</span>
                        </label>
                        
                        <!-- Drag & Drop Zone -->
                        <div id="dropZone" class="drop-zone flex-grow rounded-2xl flex flex-col items-center justify-center cursor-pointer hover:bg-stone-50 relative overflow-hidden group min-h-[250px]">
                            <input type="file" id="videoInput" accept="video/mp4,video/webm,video/quicktime" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20" onchange="handleFileSelect(this)">
                            
                            <!-- Initial State -->
                            <div id="uploadPlaceholder" class="text-center p-6 transition-opacity duration-300">
                                <div class="w-16 h-16 bg-orange-100 text-orange-500 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                    </svg>
                                </div>
                                <p class="text-stone-600 font-medium text-lg">ç‚¹å‡»æµè§ˆ æˆ– æ‹–æ‹½ä¸Šä¼ è§†é¢‘</p>
                                <p class="text-stone-400 text-sm mt-2">æ”¯æŒ MP4, WebM, MOV</p>
                            </div>

                            <!-- Video Preview State -->
                            <div id="videoPreviewContainer" class="hidden absolute inset-0 z-30 bg-black flex flex-col items-center justify-center w-full h-full">
                                <video id="videoPreview" class="w-full h-full object-contain" controls playsinline></video>
                                <div class="absolute top-0 left-0 w-full p-2 bg-gradient-to-b from-black/70 to-transparent flex justify-between items-start z-20">
                                    <span id="fileNameDisplay" class="text-white text-xs px-2 py-1 truncate max-w-[80%] opacity-80">Filename.mp4</span>
                                    <button onclick="removeVideo(event)" class="bg-black/50 hover:bg-red-600 text-white p-2 rounded-full backdrop-blur-sm transition pointer-events-auto cursor-pointer" title="åˆ é™¤è§†é¢‘">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="space-y-3 pt-4 border-t border-stone-100 mt-2">
                        <div class="flex">
                            <button onclick="callAnalysis()" class="flex-1 bg-gradient-to-r from-stone-800 to-stone-900 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-3 px-4 rounded-xl transition duration-200 flex items-center justify-center shadow-lg shadow-orange-500/10 group">
                                <span class="mr-2 group-hover:scale-110 transition-transform">âœ¨</span> AI è§†é¢‘æ·±åº¦æ‹†è§£
                            </button>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="loadingIndicator" class="hidden mt-4 bg-stone-900/10 p-6 rounded-xl border border-stone-700/20">
                        <div class="text-orange-500 flex flex-col items-center w-full text-center">
                            
                            <!-- è¿›åº¦æ¡ç»„ä»¶ -->
                            <div class="w-full mb-4">
                                <div class="flex justify-between text-xs text-orange-400 mb-2 font-mono">
                                    <span id="loadingStep">æ­£åœ¨åˆå§‹åŒ–...</span>
                                    <span id="progressPercent">0%</span>
                                </div>
                                <div class="h-3 bg-stone-800/20 rounded-full overflow-hidden border border-stone-700/30 shadow-inner relative">
                                    <div id="progressBar" class="h-full bg-gradient-to-r from-orange-700 via-orange-500 to-yellow-500 w-0 transition-all duration-300 ease-out relative">
                                        <div class="absolute inset-0 bg-white/20 w-full h-full animate-[shimmer_1s_infinite]" style="background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent); background-size: 50% 100%; background-repeat: no-repeat;"></div>
                                    </div>
                                </div>
                            </div>

                            <span class="font-bold text-lg text-stone-800 mb-1 animate-pulse">AI æ­£åœ¨è§‚çœ‹è§†é¢‘...</span>
                            <span id="loadingText" class="text-xs text-stone-500">æ­£åœ¨è¿æ¥å¤§æ¨¡å‹åˆ†æç”»é¢ï¼Œè¯·ç¨å€™...</span>
                        </div>
                    </div>
                </div>

                <!-- NEW SECTION: Meta Analysis Card (Always Visible) -->
                <!-- å¸ƒå±€ä¿®æ”¹ï¼šæ”¹ä¸º flex-1ï¼Œä½¿å…¶ä¸ä¸Šä¼ å¡ç‰‡å¹¶æ’æ˜¾ç¤ºï¼ˆåœ¨ä¸­ç­‰å±å¹•ä»¥ä¸Šï¼‰ï¼Œæˆ–è€…åœ¨å°å±ä¸Šå †å  -->
                <div id="metaAnalysisCard" class="bg-white p-6 rounded-2xl shadow-lg border border-stone-200 relative overflow-hidden transition-all duration-500 flex-1 min-h-[300px] border-l-8 border-orange-500">
                    <!-- é¡¶éƒ¨åŠŸèƒ½æ ‡è¯† -->
                    <h3 class="text-sm font-bold text-orange-600 uppercase tracking-wide mb-4 flex items-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/></svg>
                        AI åæ¨æ ¸å¿ƒé€‰é¢˜
                    </h3>
                    
                    <!-- å‚ç›´å¸ƒå±€ -->
                    <div class="space-y-4">
                        <!-- æ ¸å¿ƒé€‰é¢˜ -->
                        <div>
                            <!-- æ˜Ÿæ ‡æ ‡ç­¾ -->
                            <div class="flex items-center mb-2">
                                <span class="bg-blue-500 text-white text-xs px-2 py-0.5 rounded-full flex items-center">
                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                                    çˆ†æ¬¾æ ‡ç­¾
                                </span>
                            </div>
                            
                            <!-- æ ¸å¿ƒé€‰é¢˜æ ‡é¢˜ -->
                            <div id="metaTopic" class="text-xl font-bold text-black leading-tight">
                                <!-- é»˜è®¤çŠ¶æ€æ–‡æ¡ˆ -->
                                <span class="text-stone-400 font-normal italic text-sm">ç­‰å¾…è§†é¢‘åˆ†æ...</span>
                            </div>
                        </div>
                        
                        <!-- ä¸»é¢˜æ ‡ç­¾ç»„ -->
                        <div id="metaTags" class="flex flex-wrap gap-2">
                            <!-- é»˜è®¤å ä½æ ‡ç­¾ -->
                            <span class="bg-stone-100 text-stone-600 px-3 py-1.5 rounded-full text-xs">#ç­‰å¾…åˆ†æ</span>
                            <span class="bg-stone-100 text-stone-600 px-3 py-1.5 rounded-full text-xs">#AIè¯†åˆ«</span>
                        </div>
                        
                        <!-- ç›®æ ‡äººç¾¤ -->
                        <div>
                            <div class="text-xs text-stone-400 mb-2 uppercase font-semibold">ç²¾å‡†ç›®æ ‡äººç¾¤</div>
                            <div id="metaAudience" class="flex flex-wrap gap-2">
                                <!-- é»˜è®¤çŠ¶æ€æ–‡æ¡ˆ -->
                                <span class="text-stone-300 italic text-sm">ç­‰å¾…åˆ†æ...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åƒç´ çº§è„šæœ¬æ‹†è§£ Section -->
            <div id="pixelScriptSection" class="bg-white p-6 rounded-2xl shadow-lg border border-stone-200 relative overflow-hidden transition-all duration-500">
                <!-- é¡¶éƒ¨åŠŸèƒ½æ ‡è¯† -->
                <h3 class="text-base font-bold text-orange-600 uppercase tracking-wide mb-4 flex items-center">
                    <svg class="w-4 h-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>
                    åƒç´ çº§è„šæœ¬æ‹†è§£
                </h3>
                
                <!-- æ¿å—ç®€ä»‹ -->
                <div class="text-sm text-stone-600 mb-6">
                    ç²¾ç»†åŒ–çš„è§†é¢‘å†…å®¹åˆ†ææ–¹æ³•ï¼Œé€šè¿‡é€å¸§é•œå¤´ã€å¤šç»´åº¦çš„æ‹†è§£ï¼Œå°†çˆ†æ¬¾è§†é¢‘çš„æˆåŠŸè¦ç´ è½¬åŒ–ä¸ºå¯å¤åˆ¶çš„ç»“æ„åŒ–æ•°æ®ã€‚
                </div>
                
                <!-- è„šæœ¬å†…å®¹å®¹å™¨ -->
                <div id="scriptOutput" class="bg-stone-50 p-4 rounded-xl border border-stone-200 min-h-[200px]">
                    <!-- é»˜è®¤å ä½å†…å®¹ -->
                    <div class="flex flex-col items-center justify-center h-full text-stone-500 space-y-4">
                        <div class="w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-stone-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                        </div>
                        <div class="text-center">
                            <p class="font-medium mb-1">ç­‰å¾… AI åˆ†æ...</p>
                            <p class="text-xs max-w-[200px] opacity-70">ç‚¹å‡»ä¸Šæ–¹â€œAI è§†é¢‘æ·±åº¦æ‹†è§£â€æŒ‰é’®ï¼Œç”Ÿæˆåƒç´ çº§è„šæœ¬æ‹†è§£ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Section: Output (å¯è§†åŒ–å®¹å™¨) -->
            <!-- å¸ƒå±€ä¿®æ”¹ï¼šæ”¹ä¸ºç‹¬ç«‹çš„ä¸€è¡Œï¼Œé«˜åº¦å›ºå®š h-[600px] -->
            <div class="bg-stone-900 p-6 rounded-2xl shadow-lg border border-stone-800 text-stone-300 flex flex-col h-[600px] relative overflow-hidden">
                <div class="flex justify-between items-center mb-3">
                    <label class="block text-base font-bold text-orange-400 flex items-center">
                        <span class="bg-orange-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs mr-2">2</span>
                        <span id="outputTitle">AI åˆ†ææŠ¥å‘Š</span>
                    </label>
                    <div class="flex gap-2">
                        <button onclick="clearOutput()" class="text-xs bg-stone-800 hover:bg-stone-700 text-stone-400 px-3 py-1.5 rounded-lg transition border border-stone-700">
                            æ¸…ç©º
                        </button>
                        <button onclick="copyOutput()" class="text-xs bg-stone-700 hover:bg-stone-600 text-white px-3 py-1.5 rounded-lg transition border border-stone-600 hover:border-stone-500 flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                            å¤åˆ¶
                        </button>
                    </div>
                </div>
                <div class="relative flex-grow bg-stone-800/50 border border-stone-700 rounded-xl overflow-hidden">
                    
                    <!-- æŠ¥å‘Šæ¸²æŸ“å®¹å™¨ -->
                    <div id="aiOutput" class="w-full h-full overflow-y-auto p-4 text-sm text-stone-200 leading-relaxed custom-scrollbar">
                        <!-- é»˜è®¤å ä½å†…å®¹ -->
                        <div class="flex flex-col items-center justify-center h-full text-stone-500 space-y-4">
                            <div class="w-16 h-16 bg-stone-800 rounded-full flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-stone-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                            <div class="text-center">
                                <p class="font-medium mb-1">ç­‰å¾… AI åˆ†æ...</p>
                                <p class="text-xs max-w-[200px] opacity-70">ç‚¹å‡»ä¸Šæ–¹â€œAI è§†é¢‘æ·±åº¦æ‹†è§£â€æŒ‰é’®ï¼Œç”Ÿæˆå¯è§†åŒ–æ•°æ®æŠ¥å‘Šã€‚</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Settings Modal (Redesigned) -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-auto transform transition-all overflow-hidden">
            <!-- Modal Header -->
            <div class="bg-stone-50 px-6 py-4 border-b border-stone-200 flex justify-between items-center">
                <h3 class="text-lg font-bold text-stone-800 flex items-center gap-2">
                    <span class="bg-orange-100 text-orange-600 p-1.5 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </span>
                    API æœåŠ¡é…ç½®
                </h3>
                <button onclick="toggleSettingsModal()" class="text-stone-400 hover:text-stone-600 transition p-1 hover:bg-stone-100 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-5">
                
                <!-- 1. Provider Selection (Restored) -->
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase tracking-wide mb-2">æœåŠ¡å•† (AI Provider)</label>
                    <div class="flex bg-stone-100 p-1 rounded-lg">
                        <button id="btn-provider-openai" onclick="switchProvider('openai')" class="flex-1 py-2 px-3 text-sm font-semibold rounded-md transition-all shadow-sm bg-white text-blue-600 border border-stone-200">
                            OpenAI / å…¼å®¹æ¥å£
                        </button>
                        <button id="btn-provider-gemini" onclick="switchProvider('gemini')" class="flex-1 py-2 px-3 text-sm font-medium rounded-md text-stone-500 hover:text-stone-700 transition-all">
                            Google Gemini
                        </button>
                    </div>
                </div>

                <!-- 2. Model Selection -->
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase tracking-wide mb-2">æ¨¡å‹ (Model Name)</label>
                    <div class="relative">
                        <!-- Update: Removed icon and pr-10 padding -->
                        <input type="text" id="settingsModel" list="model-suggestions" placeholder="gemini-2.5-flash" value="gemini-2.5-flash" class="w-full px-3 py-2.5 bg-stone-50 border border-stone-300 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition font-mono text-stone-700">
                    </div>
                    <!-- æ›´æ–°åçš„æ¨¡å‹æ¨èåˆ—è¡¨ (ä¸¥æ ¼å¯¹åº”ç”¨æˆ·æä¾›çš„åŠŸèƒ½æ³¨é‡Š) -->
                    <datalist id="model-suggestions">
                        <!-- Pro ç³»åˆ— -->
                        <option value="gemini-2.5-pro">Gemini 2.5 Pro (æ”¯æŒ6å°æ—¶é•¿è§†é¢‘/å½±è§†æ‹†è§£/ç›‘æ§è¡Œä¸ºåˆ†æ/å¤šæ¨¡æ€èåˆ)</option>
                        <option value="gemini-2.5-pro-thinking">Gemini 2.5 Pro Thinking (é•¿è§†é¢‘è§£æ+æ€è€ƒæ¨¡å¼/æ—¶åºæ¨ç†/å‰§æƒ…å› æœæ¢³ç†)</option>
                        
                        <!-- 3.0 æ——èˆ°ç³»åˆ— -->
                        <option value="gemini-3-pro-preview">Gemini 3 Pro Preview (4Kè§†é¢‘å†…å®¹æ ‡æ³¨/å·¥ä¸šè´¨æ£€/é«˜åˆ†è¾¨ç‡è§£æ/å®æ—¶å¯¹é½)</option>
                        
                        <!-- æ›´æ–°: è¡¥å…… Gemini 3 Pro Thinking -->
                        <option value="gemini-3-pro-preview-thinking">Gemini 3 Pro Thinking (æ——èˆ°çº§ç²¾åº¦/é«˜åˆ†è¾¨ç‡è§£æ+å¢å¼ºæ—¶åºæ¨ç†/é«˜ç²¾åº¦è¡Œä¸ºè¯†åˆ«)</option>

                        <!-- Flash ç³»åˆ— -->
                        <option value="gemini-2.5-flash">Gemini 2.5 Flash (çŸ­è§†é¢‘è§£æâ‰¤1h/å¿«é€Ÿå†…å®¹æå–/æ‘˜è¦ç”Ÿæˆ/ä½æˆæœ¬)</option>
                        <option value="gemini-2.5-flash-image">Gemini 2.5 Flash Image (è§†é¢‘è½¬å›¾åƒç‰‡æ®µ/æˆªå›¾æå–/è§†è§‰ç‰¹å¾æ ‡æ³¨)</option>
                        <option value="gemini-2.5-flash-thinking">Gemini 2.5 Flash Thinking (çŸ­è§†é¢‘è§£æ+è½»é‡æ—¶åºæ¨ç†/Vlogåˆ†ç±»/å‰§æƒ…è„‰ç»œ)</option>
                        
                        <!-- æ›´æ–°: è¡¥å…… Gemini 3 Flash Preview -->
                        <option value="gemini-3-flash-preview">Gemini 3 Flash Preview (3ä»£è½»é‡æ——èˆ°/å»¶è¿Ÿæä½/ç›´æ’­å†…å®¹å®æ—¶æ‘˜è¦/çŸ­è§†é¢‘å¹³å°å®¡æ ¸)</option>

                        <!-- è¡¥å› OpenAI å®˜æ–¹æ¨¡å‹ -->
                        <option value="gpt-4o">GPT-4o (OpenAIæ——èˆ°/ç»¼åˆèƒ½åŠ›å¼º/å¤æ‚é€»è¾‘åˆ†æ)</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (OpenAIå¿«é€Ÿç‰ˆ/ä½æˆæœ¬/é«˜æ€§ä»·æ¯”)</option>

                        <!-- è¡¥å…… DeepSeek ç³»åˆ— (OpenAI å…¼å®¹) -->
                        <option value="deepseek-chat">DeepSeek V3 (å›½äº§ä¹‹å…‰/é«˜æ€§ä»·æ¯”/é€šç”¨èƒ½åŠ›å¼º)</option>
                        <option value="deepseek-reasoner">DeepSeek R1 (æ·±åº¦æ¨ç†/é€»è¾‘åˆ†æ/æ•°ç†æ¨å¯¼)</option>
                    </datalist>
                </div>

                <!-- 3. Base URL -->
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase tracking-wide mb-2">API åœ°å€ (Base URL)</label>
                    <div class="relative">
                        <!-- Update: Removed icon and pr-10 padding -->
                        <input type="text" id="settingsBaseUrl" placeholder="https://..." class="w-full px-3 py-2.5 bg-stone-50 border border-stone-300 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition text-stone-700">
                    </div>
                    <p id="baseUrlHint" class="text-xs text-stone-400 mt-1.5 ml-1">é»˜è®¤: https://generativelanguage.googleapis.com</p>
                </div>

                <!-- 4. API Key -->
                <div>
                    <label class="block text-xs font-bold text-stone-500 uppercase tracking-wide mb-2">API Key</label>
                    <div class="relative group">
                        <!-- Update: Removed icon button and pr-10 padding -->
                        <input type="password" id="settingsApiKey" placeholder="sk-..." class="w-full px-3 py-2.5 bg-stone-50 border border-stone-300 rounded-lg text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 outline-none transition font-mono">
                    </div>
                    <p class="text-xs text-stone-500 mt-1.5 ml-1">å¯†é’¥ä»…ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ LocalStorage ä¸­</p>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-stone-50 px-6 py-4 border-t border-stone-200 flex justify-end gap-3">
                <button onclick="toggleSettingsModal()" class="px-4 py-2 text-sm font-medium text-stone-600 hover:text-stone-800 hover:bg-stone-200 rounded-lg transition">
                    å–æ¶ˆ
                </button>
                <button onclick="saveSettings()" class="px-6 py-2 text-sm font-bold text-white bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 rounded-lg shadow-md transition transform hover:scale-[1.02]">
                    ä¿å­˜é…ç½®
                </button>
            </div>
        </div>
    </div>

    <footer class="bg-white border-t border-stone-200 py-6 text-center text-sm text-stone-500 mt-auto">
        <p>&copy; 2024 AI çˆ†æ¬¾è§†é¢‘æ‹†è§£åŠ©æ‰‹ | Powered by Gemini & OpenAI Protocols</p>
    </footer>

    <script>
        // --- Configuration Constants ---
        const CONFIG = {
            gemini: {
                defaultUrl: "https://generativelanguage.googleapis.com",
                defaultModel: "gemini-2.5-flash",
                placeholderUrl: "https://generativelanguage.googleapis.com"
            },
            openai: {
                defaultUrl: "https://www.towerfun.net/v1",
                defaultModel: "gemini-2.5-flash", 
                placeholderUrl: "https://www.towerfun.net/v1"
            },
            systemApiKey: "" 
        };

        // State
        let currentProvider = 'openai'; 
        let currentVideoBase64 = null;
        let currentVideoMimeType = null;
        let progressInterval = null; // ç”¨äºå­˜å‚¨è¿›åº¦æ¡å®šæ—¶å™¨

        // --- Settings Management ---

        function toggleSettingsModal() {
            const modal = document.getElementById('settingsModal');
            
            if (modal.classList.contains('hidden')) {
                // Load Settings on Open
                const savedProvider = localStorage.getItem('provider') || 'openai';
                switchProvider(savedProvider, false); 

                // Load custom values
                const savedBaseUrl = localStorage.getItem('customBaseUrl');
                const savedModel = localStorage.getItem('customModel');
                
                document.getElementById('settingsApiKey').value = localStorage.getItem('customApiKey') || "";
                
                // Defaults logic
                const defaultBaseUrl = CONFIG[savedProvider].defaultUrl;
                const defaultModel = CONFIG[savedProvider].defaultModel;

                document.getElementById('settingsBaseUrl').value = savedBaseUrl || defaultBaseUrl;
                document.getElementById('settingsModel').value = savedModel || defaultModel;

                modal.classList.remove('hidden');
            } else {
                modal.classList.add('hidden');
            }
        }

        function switchProvider(provider, resetDefaults = true) {
            currentProvider = provider;
            
            const btnGemini = document.getElementById('btn-provider-gemini');
            const btnOpenAI = document.getElementById('btn-provider-openai');
            
            if (provider === 'gemini') {
                btnGemini.className = "flex-1 py-2 px-3 text-sm font-semibold rounded-md transition-all shadow-sm bg-white text-orange-600 border border-stone-200";
                btnOpenAI.className = "flex-1 py-2 px-3 text-sm font-medium rounded-md text-stone-500 hover:text-stone-700 transition-all";
                document.getElementById('baseUrlHint').innerText = `é»˜è®¤: ${CONFIG.gemini.defaultUrl}`;
            } else {
                btnGemini.className = "flex-1 py-2 px-3 text-sm font-medium rounded-md text-stone-500 hover:text-stone-700 transition-all";
                btnOpenAI.className = "flex-1 py-2 px-3 text-sm font-semibold rounded-md transition-all shadow-sm bg-white text-blue-600 border border-stone-200";
                document.getElementById('baseUrlHint').innerText = `é»˜è®¤: ${CONFIG.openai.defaultUrl}`;
            }

            if (resetDefaults) {
                document.getElementById('settingsBaseUrl').value = CONFIG[provider].defaultUrl;
                document.getElementById('settingsModel').value = CONFIG[provider].defaultModel;
            }
        }

        // Removed toggleKeyVisibility function as the eye icon is removed

        function saveSettings() {
            const baseUrl = document.getElementById('settingsBaseUrl').value.trim();
            const apiKey = document.getElementById('settingsApiKey').value.trim();
            const model = document.getElementById('settingsModel').value.trim();

            localStorage.setItem('provider', currentProvider);
            localStorage.setItem('customModel', model);
            
            if (baseUrl) localStorage.setItem('customBaseUrl', baseUrl.replace(/\/$/, ""));
            else localStorage.removeItem('customBaseUrl');
            
            if (apiKey) localStorage.setItem('customApiKey', apiKey);
            else localStorage.removeItem('customApiKey');

            document.getElementById('settingsModal').classList.add('hidden');
            alert(`âœ… ${currentProvider === 'gemini' ? 'Gemini' : 'OpenAI'} æ¨¡å¼é…ç½®å·²ä¿å­˜ï¼`);
        }

        // --- Helper: Progress Bar Logic ---
        function startFakeProgress() {
            const bar = document.getElementById('progressBar');
            const percentText = document.getElementById('progressPercent');
            const stepText = document.getElementById('loadingStep');
            let width = 0;
            let progressIterations = 0;
            const maxIterations = 300; // è®¾ç½®è¶…æ—¶ï¼Œé˜²æ­¢æ— é™æœŸç­‰å¾…
            
            // é‡ç½®
            bar.style.width = '0%';
            percentText.innerText = '0%';
            stepText.innerText = 'å¼€å§‹è¿æ¥...';
            stepText.classList.remove('animate-pulse');
            
            if (progressInterval) clearInterval(progressInterval);
            
            progressInterval = setInterval(() => {
                progressIterations++;
                
                // æ¨¡æ‹Ÿè¿›åº¦å¢é•¿æ›²çº¿
                if (width < 30) {
                    width += Math.random() * 3; // å‰æœŸå¿«
                    stepText.innerText = 'æ­£åœ¨ä¸Šä¼ æ•°æ®...';
                } else if (width < 70) {
                    width += Math.random() * 0.5; // ä¸­æœŸæ…¢ (æ€è€ƒä¸­)
                    stepText.innerText = 'AI æ­£åœ¨æ·±åº¦æ€è€ƒ...';
                } else if (width < 99) {
                    width += Math.random() * 0.05; // åæœŸææ…¢ (ç­‰å¾…å“åº”)
                    stepText.innerText = 'æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...';
                } else if (width < 100) {
                    width += Math.random() * 0.01; // æœ€åé˜¶æ®µææ…¢ï¼Œæ¥è¿‘100%
                    stepText.innerText = 'ç­‰å¾…æœåŠ¡ç«¯å›ä¼  (è§†é¢‘åˆ†æè¾ƒæ…¢ï¼Œè¯·ç¨å€™)...';
                    stepText.classList.add('animate-pulse'); // å¢åŠ å‘¼å¸æ•ˆæœæç¤ºæ­£åœ¨è¿è¡Œ
                } else {
                    // å¦‚æœè¾¾åˆ°100%ä½†finishProgressè¿˜æ²¡è¢«è°ƒç”¨ï¼Œè¯´æ˜å¯èƒ½å‡ºç°äº†é—®é¢˜
                    stepText.innerText = 'åˆ†æå¯èƒ½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–APIé…ç½®...';
                    stepText.classList.add('animate-pulse');
                }
                
                // ç¡®ä¿widthä¸è¶…è¿‡100%
                width = Math.min(width, 100);
                
                bar.style.width = width + '%';
                percentText.innerText = Math.floor(width) + '%';
                
                // è¶…æ—¶å¤„ç†
                if (progressIterations > maxIterations) {
                    clearInterval(progressInterval);
                    stepText.innerText = 'åˆ†æè¶…æ—¶ï¼Œè¯·é‡è¯•æˆ–æ£€æŸ¥APIé…ç½®...';
                    stepText.classList.add('animate-pulse');
                }
            }, 200);
        }

        function finishProgress() {
            if (progressInterval) clearInterval(progressInterval);
            const bar = document.getElementById('progressBar');
            const percentText = document.getElementById('progressPercent');
            const stepText = document.getElementById('loadingStep');
            
            bar.style.width = '100%';
            percentText.innerText = '100%';
            stepText.innerText = 'åˆ†æå®Œæˆï¼';
        }

        // é‡ç½® Meta å¡ç‰‡ä¸ºé»˜è®¤çŠ¶æ€
        function resetMetaCard() {
            const audienceEl = document.getElementById('metaAudience');
            const topicEl = document.getElementById('metaTopic');
            const tagsEl = document.getElementById('metaTags');
            
            if(audienceEl) audienceEl.innerHTML = '<span class="text-stone-300 italic">ç­‰å¾…åˆ†æ...</span>';
            if(topicEl) topicEl.innerHTML = '<span class="text-stone-400 font-normal italic">ç­‰å¾…è§†é¢‘åˆ†æ...</span>';
            if(tagsEl) tagsEl.innerHTML = '<span class="bg-stone-100 text-stone-300 px-2 py-1 rounded text-xs">#ç­‰å¾…åˆ†æ</span> <span class="bg-stone-100 text-stone-300 px-2 py-1 rounded text-xs">#AIè¯†åˆ«</span>';
        }

        // --- Core Logic: Unified AI Caller ---

        function callAnalysis() {
            // å‡çº§äº† Promptï¼š
            // 1. è¦æ±‚ AI ç›´æ¥è¾“å‡º HTML ç»“æ„ (Tailwind CSS)ï¼Œè€Œä¸æ˜¯ Markdownã€‚
            // 2. å¢åŠ  META æ•°æ®æŒ‡ä»¤ï¼šè¦æ±‚åœ¨å¼€å¤´è¾“å‡º JSON æ ¼å¼çš„æ ¸å¿ƒé€‰é¢˜å’Œæ ‡ç­¾
            const systemPrompt = `ä½ æ˜¯ä¸€ä½æ‹¥æœ‰10å¹´ç»éªŒçš„çŸ­è§†é¢‘è¿è¥ä¸“å®¶å’Œçˆ†æ¬¾æ“ç›˜æ‰‹ã€‚è¯·ä»”ç»†è§‚çœ‹è¿™æ®µè§†é¢‘ï¼Œè¿›è¡Œâ€œåƒç´ çº§â€çš„æ·±åº¦æ‹†è§£ã€‚

            ä½ çš„ä»»åŠ¡åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š
            
            ã€ç¬¬ä¸€éƒ¨åˆ†ï¼šAI ç®—æ³•ç”Ÿæˆå…ƒæ•°æ® (Hidden JSON)ã€‘
            è¯·å…ˆåœ¨æ€ç»´æ²™ç®±ä¸­è¿›è¡Œä»¥ä¸‹åˆ†æï¼Œç„¶åç”Ÿæˆ JSON æ•°æ®ï¼š
            1. **ç›®æ ‡äººç¾¤åˆ†æ**ï¼šè¯†åˆ«è§†é¢‘é’ˆå¯¹çš„æ ¸å¿ƒäººç¾¤ï¼ˆå¦‚ï¼šåˆ›ä¸šå°ç™½ã€ç²¾è‡´å®å¦ˆã€èŒåœºæ–°äººï¼‰ã€‚
            2. **å…³é”®è¯æå–**ï¼šæå–è§†é¢‘çš„æ ¸å¿ƒå…³é”®è¯ï¼ˆå¦‚ï¼šé•¿æœŸä¸»ä¹‰ã€è®¤çŸ¥è§‰é†’ã€æé’±ï¼‰ã€‚
            3. **é€‰é¢˜æ ‡é¢˜ç”Ÿæˆç®—æ³•**ï¼š
               - è¿ç”¨ **"é—®é¢˜å¯¼å‘"** (æ™®é€šäººå¦‚ä½•...?)
               - è¿ç”¨ **"ç—›ç‚¹æŒ–æ˜"** (è§£å†³...ç„¦è™‘)
               - è¿ç”¨ **"åå·®è®¾è®¡"** (å¯¹ç«‹æ¦‚å¿µåˆ¶é€ å†²çª)
               - è¿ç”¨ **"åœºæ™¯åŒ–æè¿°"** (å¢å¼ºä»£å…¥æ„Ÿ)
               *ç»¼åˆä»¥ä¸ŠæŠ€å·§ï¼Œç”Ÿæˆä¸€ä¸ªæœ€å…·å¸å¼•åŠ›çš„â€œæ ¸å¿ƒé€‰é¢˜æ ‡é¢˜â€*ã€‚
            4. **çˆ†æ¬¾æ ‡ç­¾ç”Ÿæˆ**ï¼š
               - **é¢†åŸŸæ ‡ç­¾** (åˆ›ä¸šæ€ç»´)
               - **æƒ…ç»ªæ ‡ç­¾** (è®¤çŸ¥è§‰é†’ã€äººæ€§æ´å¯Ÿ)
               - **ç»“æœå¯¼å‘æ ‡ç­¾** (æé’±ã€æ¶¨ç²‰)
               - **å‚ç›´ç»†åˆ†æ ‡ç­¾** (é«˜ç«¯å®¶æ”¿)
               *æŒ‰æƒé‡æ’åºï¼Œé€‰å‡ºæœ€é‡è¦çš„ 4-6 ä¸ªæ ‡ç­¾*ã€‚

            ã€ç¬¬äºŒéƒ¨åˆ†ï¼šå¯è§†åŒ–åˆ†ææŠ¥å‘Š (HTML)ã€‘
            ç”Ÿæˆè¯¦ç»†çš„æ‹†è§£æŠ¥å‘Šã€‚

            âš ï¸ã€è¾“å‡ºæ ¼å¼ä¸¥æ ¼è¦æ±‚ã€‘ï¼š
            
            ç¬¬1è¡Œï¼šå¿…é¡»æ˜¯ JSON å…ƒæ•°æ®æ³¨é‡Šï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
            <!-- META: {"topic": "è¿™é‡Œå¡«è¿ç”¨äº†åå·®/ç—›ç‚¹/åœºæ™¯ç”Ÿæˆçš„æ ¸å¿ƒé€‰é¢˜æ ‡é¢˜", "audience": "è¿™é‡Œå¡«ç›®æ ‡äººç¾¤", "tags": ["é¢†åŸŸæ ‡ç­¾", "æƒ…ç»ªæ ‡ç­¾", "ç»“æœæ ‡ç­¾", "ç»†åˆ†æ ‡ç­¾"]} -->

            ç¬¬2è¡Œï¼šå¿…é¡»æ˜¯æ ¸å¿ƒé€»è¾‘æ€»ç»“æ³¨é‡Šï¼š
            <!-- SUMMARY: æ­ç§˜â€œï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰â€çš„çˆ†æ¬¾æ‰“æ³• -->

            ç¬¬3è¡Œå¼€å§‹ï¼šç›´æ¥è¾“å‡º HTML ä»£ç ï¼ˆä¸è¦ markdown æ ‡è®°ï¼‰ï¼š
            <div class="space-y-6">
               <!-- æ¨¡å—1: ä»ªè¡¨ç›˜ -->
               <div class="grid grid-cols-2 gap-4">
                  <div class="bg-stone-700/50 p-4 rounded-xl border border-stone-600">
                     <div class="text-xs text-stone-400 mb-1">å®Œæ’­ç‡é¢„ä¼°</div>
                     <div class="text-2xl font-bold text-white flex items-center gap-2">
                        [S/A/Bçº§] <span class="text-xs px-2 py-1 rounded bg-stone-600 font-normal">ç†ç”±ç®€è¿°</span>
                     </div>
                  </div>
                  <div class="bg-stone-700/50 p-4 rounded-xl border border-stone-600">
                     <div class="text-xs text-stone-400 mb-1">æƒ…æ„Ÿå…±é¸£æŒ‡æ•°</div>
                     <div class="flex items-center gap-2">
                        <div class="flex-grow h-2 bg-stone-600 rounded-full overflow-hidden">
                           <div class="h-full bg-orange-500" style="width: [åˆ†æ•°*10]%"></div>
                        </div>
                        <span class="text-xl font-bold text-orange-400">[åˆ†æ•°]</span>
                     </div>
                     <div class="text-xs text-stone-500 mt-1">æ¿€å‘æƒ…ç»ª: [æƒ…ç»ªå…³é”®è¯]</div>
                  </div>
               </div>

               <!-- æ¨¡å—2: é»„é‡‘3ç§’ Hook -->
               <div class="bg-stone-800 p-5 rounded-xl border-l-4 border-orange-500 shadow-md">
                  <h3 class="text-sm font-bold text-orange-400 uppercase mb-3 tracking-wider">âš¡ï¸ é»„é‡‘å‰3ç§’ (Hook)</h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                     <div>
                        <span class="text-xs bg-stone-700 text-stone-300 px-2 py-0.5 rounded">ğŸ‘€ è§†è§‰ Hook</span>
                        <p class="text-sm text-stone-200 mt-2 leading-relaxed">[å†…å®¹]</p>
                     </div>
                     <div>
                        <span class="text-xs bg-stone-700 text-stone-300 px-2 py-0.5 rounded">ğŸ‘‚ å¬è§‰/æ–‡æ¡ˆ</span>
                        <p class="text-sm text-stone-200 mt-2 leading-relaxed">[å†…å®¹]</p>
                     </div>
                  </div>
               </div>

               <!-- æ¨¡å—3: è„šæœ¬è¿˜åŸ -->
               <div class="space-y-3">
                  <h3 class="text-sm font-bold text-stone-400 uppercase tracking-wider">ğŸ“ è„šæœ¬æ ¸å¿ƒ</h3>
                  <div class="bg-stone-700/30 p-4 rounded-lg text-sm text-stone-300 italic border-l-2 border-stone-600">
                     â€œ[è§†é¢‘æ ¸å¿ƒé‡‘å¥æˆ–ç¥å›å¤]â€
                  </div>
                  <p class="text-sm text-stone-400">[ä¸€å¥è¯æ•…äº‹æ¢—æ¦‚]</p>
               </div>

               <!-- æ¨¡å—4: ç»“æ„å¤ç›˜ (Timeline) -->
               <div class="relative pl-4 border-l border-stone-700 space-y-6 my-4">
                  <div class="relative">
                     <div class="absolute -left-[21px] top-1 w-3 h-3 bg-green-500 rounded-full border-2 border-stone-900"></div>
                     <div class="text-xs text-green-400 font-bold mb-1">OPENING (0-5s)</div>
                     <div class="text-sm text-stone-300">[å¼€åœºç­–ç•¥]</div>
                  </div>
                  <div class="relative">
                     <div class="absolute -left-[21px] top-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-stone-900"></div>
                     <div class="text-xs text-blue-400 font-bold mb-1">MIDDLE</div>
                     <div class="text-sm text-stone-300">[å†²çª/å¹²è´§/åè½¬]</div>
                  </div>
                  <div class="relative">
                     <div class="absolute -left-[21px] top-1 w-3 h-3 bg-red-500 rounded-full border-2 border-stone-900"></div>
                     <div class="text-xs text-red-400 font-bold mb-1">ENDING</div>
                     <div class="text-sm text-stone-300">[ç»“å°¾å‡å/CTA]</div>
                  </div>
               </div>

               <!-- æ¨¡å—5: æµé‡å¯†ç  -->
               <div class="bg-gradient-to-r from-orange-900/30 to-stone-800 p-5 rounded-xl border border-orange-500/30">
                  <h3 class="text-sm font-bold text-orange-300 uppercase mb-2">ğŸ’¡ æŠ„ä½œä¸šå»ºè®®</h3>
                  <ul class="text-sm text-stone-300 space-y-2 list-disc list-inside">
                     <li><strong>åº•å±‚é€»è¾‘ï¼š</strong> [å†…å®¹]</li>
                     <li><strong>çµé­‚å…ƒç´ ï¼š</strong> [å†…å®¹]</li>
                     <li><strong>å¯è¿ç§»èµ›é“ï¼š</strong> [å†…å®¹]</li>
                  </ul>
               </div>
            </div>`;

            callAIService(systemPrompt, "æ­£åœ¨è¿ç”¨ç®—æ³•åæ¨æ ¸å¿ƒé€‰é¢˜ä¸æ ‡ç­¾...");
            document.getElementById('outputTitle').innerText = "AI æ·±åº¦æ‹†è§£æŠ¥å‘Š";
            
            // è®¾ç½® UI çŠ¶æ€ä¸ºâ€œæ­£åœ¨åˆ†æâ€
            document.getElementById('metaAudience').innerHTML = '<span class="text-orange-500 animate-pulse">åˆ†æä¸­...</span>';
            document.getElementById('metaTopic').innerHTML = '<span class="text-orange-500 animate-pulse">æ­£åœ¨è¿ç”¨ç®—æ³•ç”Ÿæˆ...</span>';
            document.getElementById('metaTags').innerHTML = '<span class="bg-stone-100 text-stone-300 px-2 py-1 rounded text-xs animate-pulse">#ç®—æ³•åŒ¹é…ä¸­...</span>';
        }

        // Dispatcher
        async function callAIService(systemPrompt, loadingMsg) {
            const provider = localStorage.getItem('provider') || 'openai';
            
            if (provider === 'gemini') {
                await callGeminiImpl(systemPrompt, loadingMsg);
            } else {
                await callOpenAIImpl(systemPrompt, loadingMsg);
            }
        }

        // ğŸŒŸ æ–°å¢åŠŸèƒ½ï¼šè§£æå¹¶æ›´æ–°é¡¶éƒ¨çš„æ ¸å¿ƒæ€»ç»“
        function updateHeaderWithInsight(fullText) {
            const headerIntro = document.getElementById('header-intro');
            // æ­£åˆ™åŒ¹é… HTML æ³¨é‡Šä¸­çš„ SUMMARY
            const match = fullText.match(/<!-- SUMMARY: (.*?) -->/);
            
            if (match && match[1]) {
                const insight = match[1].trim();
                
                headerIntro.style.opacity = '0';
                setTimeout(() => {
                    headerIntro.innerHTML = `ğŸš€ <span class="font-bold text-orange-600 text-xl">${insight}</span>`;
                    headerIntro.className = "text-lg text-stone-800 max-w-4xl mx-auto bg-orange-50 p-4 rounded-xl border border-orange-200 shadow-sm transition-all duration-500 ease-in-out transform scale-105";
                    headerIntro.style.opacity = '1';
                }, 500);
            }
        }

        // ğŸŒŸ æ–°å¢åŠŸèƒ½ï¼šè§£æå¹¶æ›´æ–°å·¦ä¾§çš„ Meta åˆ†æå¡ç‰‡ (é€‰é¢˜ & æ ‡ç­¾ & äººç¾¤)
        function updateMetaAnalysis(fullText) {
            // æ­£åˆ™åŒ¹é… <!-- META: {...} -->
            const match = fullText.match(/<!-- META: (.*?) -->/);
            
            if (match && match[1]) {
                try {
                    const data = JSON.parse(match[1]);
                    
                    // 1. æ›´æ–°äººç¾¤
                    const audienceEl = document.getElementById('metaAudience');
                    if (data.audience) {
                        audienceEl.innerHTML = `<span class="text-stone-700 font-semibold">${data.audience}</span>`;
                    } else {
                        audienceEl.innerText = "é€šç”¨äººç¾¤";
                    }

                    // 2. æ›´æ–°é€‰é¢˜
                    const topicEl = document.getElementById('metaTopic');
                    if (data.topic) {
                        topicEl.innerText = data.topic;
                        topicEl.className = "text-lg font-bold text-orange-600 leading-tight drop-shadow-sm";
                    }
                    
                    // 3. æ›´æ–°æ ‡ç­¾
                    const tagsEl = document.getElementById('metaTags');
                    if (data.tags && Array.isArray(data.tags)) {
                        tagsEl.innerHTML = data.tags.map(tag => {
                            // éšæœºåˆ†é…å‡ ç§æ ‡ç­¾é¢œè‰²ï¼Œæ¨¡æ‹Ÿâ€œæ˜Ÿæ ‡â€æ„Ÿ
                            const colors = [
                                "bg-orange-50 text-orange-700 border-orange-200 ring-1 ring-orange-100",
                                "bg-blue-50 text-blue-700 border-blue-200 ring-1 ring-blue-100",
                                "bg-purple-50 text-purple-700 border-purple-200 ring-1 ring-purple-100",
                                "bg-emerald-50 text-emerald-700 border-emerald-200 ring-1 ring-emerald-100"
                            ];
                            const randomColor = colors[Math.floor(Math.random() * colors.length)];
                            return `<span class="px-2.5 py-1 rounded-md text-xs font-bold border shadow-sm ${randomColor}">#${tag}</span>`;
                        }).join('');
                    }

                } catch (e) {
                    console.error("Meta parse error:", e);
                }
            }
        }

        // ğŸŒŸ æ¸²æŸ“ HTML æŠ¥å‘Š
        function renderReport(htmlContent) {
            const outputDiv = document.getElementById('aiOutput');
            const scriptOutputDiv = document.getElementById('scriptOutput');
            
            // ç®€å•æ¸…ç†å¯èƒ½å­˜åœ¨çš„ markdown æ ‡è®° (ä»¥é˜²ä¸‡ä¸€)
            let cleanHtml = htmlContent.replace(/```html/g, '').replace(/```/g, '');
            
            // æå–åƒç´ çº§è„šæœ¬æ‹†è§£å†…å®¹
            const scriptRegex = /<div[^>]*>.*?åƒç´ çº§è„šæœ¬æ‹†è§£.*?<\/div>/s;
            const scriptMatch = cleanHtml.match(scriptRegex);
            
            if (scriptMatch && scriptMatch[0]) {
                // æ˜¾ç¤ºè„šæœ¬å†…å®¹
                scriptOutputDiv.innerHTML = `<div class="report-fade-in">${scriptMatch[0]}</div>`;
                // è¿‡æ»¤æ‰AIåˆ†ææŠ¥å‘Šä¸­çš„è„šæœ¬å†…å®¹
                cleanHtml = cleanHtml.replace(scriptRegex, '');
            } else {
                // æ˜¾ç¤ºé»˜è®¤å†…å®¹
                scriptOutputDiv.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-stone-500 space-y-4">
                        <div class="w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-stone-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                        </div>
                        <div class="text-center">
                            <p class="font-medium mb-1">AI æ­£åœ¨ç”Ÿæˆè„šæœ¬...</p>
                            <p class="text-xs max-w-[200px] opacity-70">ç­‰å¾… AI åˆ†æå®Œæˆï¼Œå°†æ˜¾ç¤ºè¯¦ç»†çš„åƒç´ çº§è„šæœ¬æ‹†è§£ã€‚</p>
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºAIåˆ†ææŠ¥å‘Š
            outputDiv.innerHTML = `<div class="report-fade-in">${cleanHtml}</div>`;
            
            // è§¦å‘å¤´éƒ¨æ›´æ–°
            updateHeaderWithInsight(htmlContent);
            // è§¦å‘ Meta å¡ç‰‡æ›´æ–°
            updateMetaAnalysis(htmlContent);
        }

        // --- Implementation: Gemini (Native) ---
        async function callGeminiImpl(systemPrompt, loadingMsg) {
            const outputDiv = document.getElementById('aiOutput'); // å·²ç»æ˜¯ Div äº†
            const loader = document.getElementById('loadingIndicator');
            const loadingText = document.getElementById('loadingText');

            if (!currentVideoBase64) {
                 if(!loader.classList.contains('hidden')) loader.classList.add('hidden');
                 return;
            }

            let baseUrl = localStorage.getItem('customBaseUrl') || CONFIG.gemini.defaultUrl;
            baseUrl = baseUrl.replace(/\/$/, ""); 
            const apiKey = localStorage.getItem('customApiKey') || CONFIG.systemApiKey;
            const model = localStorage.getItem('customModel') || CONFIG.gemini.defaultModel;

            if (!checkAuth(apiKey, baseUrl, CONFIG.gemini.defaultUrl)) return;

            loadingText.innerText = loadingMsg || "Gemini æ­£åœ¨æ€è€ƒ...";
            loader.classList.remove('hidden');
            // outputDiv.innerHTML = ""; // å¯ä»¥ä¸æ¸…ç©ºï¼Œæˆ–è€…æ˜¾ç¤ºéª¨æ¶å±ï¼Œè¿™é‡Œå…ˆä¿ç•™åŸçŠ¶
            
            startFakeProgress();

            try {
                const url = `${baseUrl}/v1beta/models/${model}:generateContent?key=${apiKey}`;
                const payload = {
                    contents: [{
                        parts: [
                            { text: systemPrompt },
                            { inlineData: { mimeType: currentVideoMimeType, data: currentVideoBase64 } }
                        ]
                    }],
                    generationConfig: { temperature: 0.7, maxOutputTokens: 2000 }
                };

                const data = await fetchAPI(url, payload);
                finishProgress();

                if (data.candidates && data.candidates[0].content) {
                    const resultText = data.candidates[0].content.parts[0].text;
                    setTimeout(() => {
                        loader.classList.add('hidden');
                        renderReport(resultText); // ä½¿ç”¨ HTML æ¸²æŸ“
                    }, 500);
                } else {
                    throw new Error("Gemini API è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸");
                }
            } catch (error) {
                if (progressInterval) clearInterval(progressInterval);
                loader.classList.add('hidden');
                outputDiv.innerText = `âŒ å‡ºé”™: ${error.message}`;
            }
        }

        // --- Implementation: OpenAI (Compatible) ---
        async function callOpenAIImpl(systemPrompt, loadingMsg) {
            const outputDiv = document.getElementById('aiOutput');
            const loader = document.getElementById('loadingIndicator');
            const loadingText = document.getElementById('loadingText');

            if (!currentVideoBase64) {
                 if(!loader.classList.contains('hidden')) loader.classList.add('hidden');
                 return;
            }

            let baseUrl = localStorage.getItem('customBaseUrl') || CONFIG.openai.defaultUrl;
            baseUrl = baseUrl.replace(/\/$/, ""); 
            const apiKey = localStorage.getItem('customApiKey') || CONFIG.systemApiKey;
            const model = localStorage.getItem('customModel') || CONFIG.openai.defaultModel;

            if (!checkAuth(apiKey, baseUrl, CONFIG.openai.defaultUrl)) return;

            loadingText.innerText = loadingMsg || "AI æ­£åœ¨åˆ†æ...";
            loader.classList.remove('hidden');
            // outputDiv.innerHTML = "";
            
            startFakeProgress();

            try {
                const url = `${baseUrl}/chat/completions`;
                const messages = [
                    { role: "system", content: systemPrompt },
                    { 
                        role: "user", 
                        content: [
                            { type: "text", text: "Please analyze this video file." },
                            {
                                type: "image_url",
                                image_url: { url: `data:${currentVideoMimeType};base64,${currentVideoBase64}` }
                            }
                        ]
                    }
                ];

                const payload = {
                    model: model, messages: messages, temperature: 0.7, max_tokens: 2000, stream: false
                };
                const headers = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` };

                const data = await fetchAPI(url, payload, headers);
                finishProgress();

                if (data.choices && data.choices[0].message) {
                    const resultText = data.choices[0].message.content;
                    setTimeout(() => {
                        loader.classList.add('hidden');
                        renderReport(resultText); // ä½¿ç”¨ HTML æ¸²æŸ“
                    }, 500);
                } else {
                    console.error("API Response:", data);
                    throw new Error("API è¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸");
                }
            } catch (error) {
                if (progressInterval) clearInterval(progressInterval);
                loader.classList.add('hidden');
                outputDiv.innerText = `âŒ å‡ºé”™: ${error.message}`;
            }
        }

        // --- Helpers ---

        function checkAuth(apiKey, baseUrl, defaultUrl) {
            const loader = document.getElementById('loadingIndicator');
            if (!apiKey && baseUrl === defaultUrl) {
                loader.classList.add('hidden');
                const userConfirmed = confirm("âš ï¸ æœªæ£€æµ‹åˆ° API Keyã€‚è¯·ç‚¹å‡»å³ä¸Šè§’âš™ï¸é…ç½®ã€‚æ˜¯å¦ç»§ç»­å°è¯• (å¯èƒ½å¤±è´¥)ï¼Ÿ");
                return userConfirmed;
            }
            return true;
        }

        async function fetchAPI(url, payload, customHeaders = {}) {
            const headers = { 'Content-Type': 'application/json', ...customHeaders };
            const response = await fetchWithRetry(url, { method: 'POST', headers: headers, body: JSON.stringify(payload) });
            return await response.json();
        }

        async function fetchWithRetry(url, options, maxRetries = 2) {
            let retries = 0;
            while (retries < maxRetries) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        const errText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errText.substring(0, 100)}...`);
                    }
                    return response;
                } catch (error) {
                    retries++;
                    console.warn(`Retry ${retries}/${maxRetries}: ${error.message}`);
                    if (retries >= maxRetries) throw error;
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
        }

        function handleError(error, outputElement) {
            // ç®€å•çš„é”™è¯¯å±•ç¤º
            outputElement.innerHTML = `<div class="text-red-400 p-4 border border-red-500 rounded">âŒ è¯·æ±‚å¤±è´¥: ${error.message}</div>`;
        }

        // --- Existing File Logic & UI Effects ---
        function handleFileSelect(input) {
            const file = input.files[0];
            if (!file) return;

            const preview = document.getElementById('videoPreview');
            const previewContainer = document.getElementById('videoPreviewContainer');
            const placeholder = document.getElementById('uploadPlaceholder');
            const fileNameDisplay = document.getElementById('fileNameDisplay');
            const videoInput = document.getElementById('videoInput');

            const url = URL.createObjectURL(file);
            preview.src = url;
            fileNameDisplay.innerText = file.name;
            
            previewContainer.classList.remove('hidden');
            placeholder.classList.add('opacity-0');
            videoInput.classList.add('hidden'); 

            const loadingText = document.getElementById('loadingText');
            const loader = document.getElementById('loadingIndicator');
            
            loadingText.innerText = `æ­£åœ¨è¯»å–è§†é¢‘æ•°æ® (${(file.size / 1024 / 1024).toFixed(1)} MB)... è¯·ç¨å€™`;
            loader.classList.remove('hidden');

            setTimeout(() => {
                const reader = new FileReader();
                reader.onloadend = function() {
                    const base64String = reader.result;
                    const dataIndex = base64String.indexOf('base64,') + 7;
                    currentVideoBase64 = base64String.substring(dataIndex);
                    currentVideoMimeType = file.type || 'video/mp4';

                    console.log("Video loaded. Ready for user to click analyze.");
                    
                    loader.classList.add('hidden');
                    loadingText.innerText = "æ­£åœ¨è¿æ¥å¤§æ¨¡å‹åˆ†æç”»é¢ï¼Œè¯·ç¨å€™..."; 
                }
                reader.readAsDataURL(file); 
            }, 100);
        }

        function removeVideo(e) {
            if(e) { e.stopPropagation(); e.preventDefault(); }
            const input = document.getElementById('videoInput');
            const preview = document.getElementById('videoPreview');
            const previewContainer = document.getElementById('videoPreviewContainer');
            const placeholder = document.getElementById('uploadPlaceholder');
            const loader = document.getElementById('loadingIndicator');

            URL.revokeObjectURL(preview.src);
            preview.src = '';
            input.value = ''; 
            currentVideoBase64 = null;
            loader.classList.add('hidden'); 
            
            previewContainer.classList.add('hidden');
            placeholder.classList.remove('opacity-0');
            input.classList.remove('hidden'); 
            
            // æ¢å¤é¡¶éƒ¨æ–‡æ¡ˆ
            const headerIntro = document.getElementById('header-intro');
            headerIntro.innerHTML = `ç›´æ¥ä¸Šä¼ çˆ†æ¬¾è§†é¢‘æ–‡ä»¶ï¼ŒAI å°†è‡ªåŠ¨åˆ†æå¹¶æ­ç§˜å…¶<span class="font-bold text-stone-700">â€œç”»é¢ã€è„šæœ¬ä¸æƒ…ç»ªâ€</span>èƒŒåçš„æµé‡å¯†ç ã€‚`;
            headerIntro.className = "text-lg text-stone-600 max-w-2xl mx-auto transition-all duration-500 ease-in-out";
            
            resetMetaCard();
            
            // æ¸…ç©ºæŠ¥å‘Š
            document.getElementById('aiOutput').innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-stone-500 space-y-4">
                    <div class="w-16 h-16 bg-stone-800 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-stone-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <p class="font-medium mb-1">ç­‰å¾… AI åˆ†æ...</p>
                        <p class="text-xs max-w-[200px] opacity-70">ç‚¹å‡»å·¦ä¾§â€œAI è§†é¢‘æ·±åº¦æ‹†è§£â€æŒ‰é’®ï¼Œç”Ÿæˆå¯è§†åŒ–æ•°æ®æŠ¥å‘Šã€‚</p>
                    </div>
                </div>`;
        }

        function clearOutput() {
            resetMetaCard();
            
            // æ¸…ç©ºAIåˆ†ææŠ¥å‘Š
            document.getElementById('aiOutput').innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-stone-500 space-y-4">
                    <div class="w-16 h-16 bg-stone-800 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-stone-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                    </div>
                    <div class="text-center">
                        <p class="font-medium mb-1">å·²æ¸…ç©º</p>
                        <p class="text-xs max-w-[200px] opacity-70">ç‚¹å‡»åˆ†æé‡æ–°ç”Ÿæˆã€‚</p>
                    </div>
                </div>`;
            
            // æ¸…ç©ºåƒç´ çº§è„šæœ¬æ‹†è§£
            document.getElementById('scriptOutput').innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-stone-500 space-y-4">
                    <div class="w-16 h-16 bg-stone-100 rounded-full flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-stone-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                    </div>
                    <div class="text-center">
                        <p class="font-medium mb-1">ç­‰å¾… AI åˆ†æ...</p>
                        <p class="text-xs max-w-[200px] opacity-70">ç‚¹å‡»ä¸Šæ–¹â€œAI è§†é¢‘æ·±åº¦æ‹†è§£â€æŒ‰é’®ï¼Œç”Ÿæˆåƒç´ çº§è„šæœ¬æ‹†è§£ã€‚</p>
                    </div>
                </div>`;
        }

        function copyOutput() {
            const outputDiv = document.getElementById("aiOutput");
            const range = document.createRange();
            range.selectNode(outputDiv);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand("copy");
            window.getSelection().removeAllRanges();

            const btn = document.querySelector('button[onclick="copyOutput()"]');
            const originalHTML = btn.innerHTML;
            btn.innerHTML = 'âœ… å·²å¤åˆ¶';
            btn.classList.add('text-green-400', 'border-green-400');
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.classList.remove('text-green-400', 'border-green-400');
            }, 2000);
        }
        
        // Drop zone logic
        const dropZone = document.getElementById('dropZone');
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, e => { e.preventDefault(); e.stopPropagation(); }, false);
        });
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
        });
        dropZone.addEventListener('drop', e => {
            const dt = e.dataTransfer;
            const files = dt.files;
            document.getElementById('videoInput').files = files;
            handleFileSelect(document.getElementById('videoInput'));
        }, false);
    </script>
</body>
</html># -
